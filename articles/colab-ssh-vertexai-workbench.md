---
title: '法と規約に怯えずに "Colab" を正々堂々 SSH 接続で使う'
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

最近, インターン先で「既存サービスのビッグデータを使って, ML モデルを作って, サーバサイドに実装して, AB で効果測定して, 改善する」というサイクル全体のお仕事をさせていただいていて, MLOps 的なこともアイデア, 提案段階からいろいろさせていただいています. 自分自身もたくさんサイクルを回すからこそ, そのフローの改善の効果が身をもってすごく感じられるので, MLOps 楽しい! となっていたところです.

大学の機械学習も CNN 使うようになってきて, ローカルでやるのしんどくなってきたけど, Colab ブラウザで使うのは開発体験悪すぎて, Copilot に慣れてしまった体ではつらいので, SSH 接続でやってみようという会になります.

## 法と規約

ただし, ここで注意しなければならないのが, Colab の利用規約. SSH 接続のようにリモートホスティングで使うことは, "無料版" では禁止されています.

それなら, "有料版" ならできるのかという話なんですが, Colab の有料版には, Colab Pro (research.google.com 提供) と Colab Enterprise (gcp 提供) がありますが, そのどちらも, 禁止はされていないけど, 公式の機能として提供されているわけではないので, python 上で適切なコードを実行することで, ローカル ip をグローバルの世界に繋げてあげる必要があります.

これが, 「colab ssh」で出てくる多くの記事で紹介されている, ngrok や cloudflared を使った方法です.

この方法については, ここでは詳しく説明しないですが, 以下の記事が参考になります.

ただし, 繰り返しにはなりますが, "無料版" Colab でこれらの方法を使うのは規約に違反するのでご注意ください.

https://colab.research.google.com/github/worachot-n/colab-ssh-vscode/blob/main/colab_ssh_vscode.ipynb#scrollTo=O7UAuUPwpA6t

https://qiita.com/hazigin/items/c291adf5dc9ccc13d11f

## そもそも Colab の何が便利なのか?

では, そもそも「 SSH 接続で, Colab を使いたい」という需要は, 何が便利で生まれるのでしょうか?

まず, 「 SSH 接続」より生まれるメリットは以下のような感じだと思います.

- 手元の任意の好きなエディタを使えることによる開発体験の向上
- GitHub Copilot のアシストによる開発速度の向上
- モデル生成フェーズのソースコードを git, github で管理できるようになる
  - 現状, モデルの改善などが進める上で, バージョン管理されておらず, これから, 修正を重ねていくごとに, その差分を記録するのが難しくなる可能性

次に, 本題, 「 Colab を使う」ことにより生まれるメリットはなんでしょうか?

SSH 接続で使う以上, 「ブラウザで使える手軽さ」や「その UI 」については, 今回の場合, 利点ではないと思います.

そうなると, 以下のような感じでしょうか.

- クラウド上のインスタンスをすぐ建てて利用できる
- Python, Jupyter Notebook 環境がデフォルトで整備されてる
- `pandas`, `sklearn`, `pytorch` などの統計学, 機械学習関連のライブラリがデフォルトでインストールされている
- GPU を簡単に利用できる
- GCP の他サービスとの連携のスムーズさ, 大量データの情報転送の速さ (e.g. BigQuery から学習データを取得するなど)
- Google 提供の機械学習系ライブラリ `tensorflow` などのスイートが含まれている

つまり, 必要なのはこれらの環境が完成されたインスタンスを簡単に上げ下げできることだろうと思います.

そこで, パッと思いつくのは, これらの環境をコンテナ化して, Cloud Run や ECR で, コンテナ単位でインスタントに立ち上げられるようにすることではないでしょうか?
